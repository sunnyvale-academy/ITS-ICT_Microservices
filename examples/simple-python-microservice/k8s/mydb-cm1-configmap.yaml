apiVersion: v1
data:
  initdb.sh: "\n\n#!/usr/bin/env bash\nset -e\n\npsql -v ON_ERROR_STOP=1 --username \"$POSTGRES_USER\" --dbname \"$POSTGRES_DB\" <<-EOSQL\n   -- Create user\n  CREATE USER microservice WITH PASSWORD 'microservice';\n\n  -- Create schema\n  CREATE SCHEMA microservice AUTHORIZATION microservice;\n\n  -- Create customers table in schema\n  CREATE TABLE microservice.customers (\n        id serial primary key,\n        name varchar(100) not null,\n        email varchar(100) not null unique,\n        phone varchar(15),\n        address text\n   );\n\n  -- Grant full access to user on schema, tables, and sequences\n  GRANT ALL PRIVILEGES ON SCHEMA microservice TO microservice;\n  GRANT ALL PRIVILEGES ON ALL TABLES IN SCHEMA microservice TO microservice;\n\n  -- Insert sample data\n  INSERT INTO microservice.customers (id, name, email, phone, address) VALUES\n        (1, 'John Doe', 'john.doe@oracle.com', '1234567890', '123 Oracle St, Redwood City, CA'),\n        (2, 'Jane Smith', 'jane.smith@microsoft.com', '0987654321', '456 Microsoft Ave, Redmond, WA'),\n        (3, 'Alice Johnson', 'alice.johnson@google.com', '1122334455', '789 Google Blvd, Mountain View, CA');\n    \nEOSQL"
kind: ConfigMap
metadata:
  annotations:
    use-subpath: "true"
  labels:
    io.kompose.service: mydb
  name: mydb-cm1
